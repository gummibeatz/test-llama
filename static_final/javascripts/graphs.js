require(["dialogBox","d3"],function(t,e){var n={top:20,right:40,bottom:30,left:40},a=900-n.left-n.right,i=500-n.top-n.bottom,l=e.scale.linear().range([0,a]),r=e.scale.linear().range([i,0]),o=e.scale.category10(),c={SD1:"Semantic Dimension 1",SD2:"Semantic Dimension 2",SD3:"Semantic Dimension 3"},s=e.svg.axis().scale(l).orient("bottom"),u=e.svg.axis().scale(r).orient("left"),d=e.select(".graph").append("svg").attr("width",a+n.left+n.right).attr("height",i+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),x=e.select(".graph").append("div").attr("class","tooltip").style("opacity",0);e.csv("static/csvs/combined-projections.csv",function(t,n){function f(t){d.selectAll(".dot").filter(function(e){return p(e.SD3)<t}).attr("opacity",.2),d.selectAll(".dot").filter(function(e){return p(e.SD3)>=t}).attr("opacity",1)}n.forEach(function(t){t.SD1=+t.SD1,t.SD2=+t.SD2,t.SD3=+t.SD3,t.SD4=+t.SD4});var p=e.scale.linear().domain([0,e.max(n,function(t){return t.SD3})]).range([5,20]);l.domain(e.extent(n,function(t){return t.SD1})).nice(),r.domain(e.extent(n,function(t){return t.SD2})).nice(),d.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(s).append("text").attr("class","label").attr("x",a).attr("y",-6).style("text-anchor","end").text("Semantic Dimension 1"),d.append("g").attr("class","y axis").call(u).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Semantic Dimension 2");var y=d.selectAll(".dot").data(n).enter().append("circle").attr("class","dot").attr("r",function(t){return p(t.SD3)}).attr("cx",function(t){return l(t.SD1)}).attr("cy",function(t){return r(t.SD2)}).style("fill",function(t){return o(t.institute)}).on("mouseover",function(t){x.transition().duration(200).style("opacity",.9),x.html(t.PI+" ("+t.institute+")").style("left",e.event.pageX+40+"px").style("top",e.event.pageY-28+"px")}).on("mouseout",function(t){x.transition().duration(500).style("opacity",0)}).on("click",function(t){console.log(t),doSomething()}),m=d.selectAll(".legend").data(o.domain()).enter().append("g").attr("class","legend").attr("width",10).attr("height",10).attr("transform",function(t,e){return"translate(0,"+20*e+")"});m.append("rect").attr("x",a-18).attr("y",i-105).attr("width",18).attr("height",18).style("fill",o),m.append("text").attr("x",a-24).attr("y",i-100).attr("dy",".35em").style("text-anchor","end").text(function(t,e){return t}),e.selectAll("[name=v]").on("change",function(){var t=this.value;display=this.checked?"inline":"none",d.selectAll(".dot").filter(function(e){return t==e.institute}).attr("display",display)}),e.selectAll("[name=sepal]").on("change",function(t){radius=this.value,console.log(radius),d.selectAll(".dot"),y.attr("r",function(t){return p(t[radius])})}),e.select("[name=xAX]").on("change",function(){xAxy=this.value,l.domain(e.extent(n,function(t){return t[xAxy]})).nice(),d.select(".x.axis").transition().call(s),d.selectAll(".dot").transition().attr("cx",function(t){return l(t[xAxy])}),d.selectAll(".x.axis").selectAll("text.label").text(c[xAxy])}),e.select("#radius_cutoff").on("input",function(){f(+this.value)}),e.select("[name=yAX]").on("change",function(){yAxy=this.value,r.domain(e.extent(n,function(t){return t[yAxy]})).nice(),d.select(".y.axis").transition().call(u),d.selectAll(".dot").transition().attr("cy",function(t){return r(t[yAxy])}),d.selectAll(".y.axis").selectAll("text.label").text(c[yAxy])})})});